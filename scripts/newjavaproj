# -*- mode: Shell-script-*-
#!/usr/bin/bash

# newjavaproj
# Author: Mario Fernandez
#
# Initializes a new java project, by initializing a start structure
# (with src, test and classes directories), as well as providing the following build files:
#
# - prj.el: For JDE in emacs
# - build.xml, build.properties: Build properties for ant.
#
# The project is stored in a new git repository.
#
# Usage: newjavaproj project_name (the output dir will be project_name.git)
#
# Requirements:
#
# The shell configuration at http://svn.hceris.com/shell must be
# installed. This provides the SHELL_DIR env variable, the sample prj
# and build files, and the newgit command.

local project
local elfile
local buildfile
local buildprops

if [ -z "$1" ]; then
    echo 'usage: newjavaproj project_name'
    exit 1
fi

if [ -z ${SHELL_DIR:+1} ]; then
    echo 'env variable SHELL_DIR is not set'
    exit 1
fi

elfile=${SHELL_DIR}/sample-prj.el

if [ ! -f $elfile ]; then
    echo 'cannot find project file'
    exit 1
fi

buildfile=${SHELL_DIR}/sample-build.xml

if [ ! -f $buildfile ]; then
    echo 'cannot find build file'
    exit 1
fi

buildprops=${SHELL_DIR}/sample-build.properties

if [ ! -f $buildprops ]; then
    echo 'cannot find build properties'
    exit 1
fi

project=$1
newgit $project

echo 'Creating folders'

mkdir -p src/com/hceris
mkdir -p test/com/hceris
mkdir -p classes
mkdir lib

echo 'Initializing project file'

    # sample files are changed so that the name of the project is used for some variables
cp $elfile prj.el
sed "s/{name}/$(basename $PWD)/g" prj.el > tmp && mv tmp prj.el

echo 'Initializing build file'

cp $buildfile build.xml
sed "s/{name}/$(basename $PWD)/g" build.xml > tmp && mv tmp build.xml

cp $buildprops build.properties

echo 'Commiting project file'

git add prj.el
git commit -m "added prj file"
git push
